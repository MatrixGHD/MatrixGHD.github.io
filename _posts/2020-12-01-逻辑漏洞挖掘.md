---
layout:     post
title:      逻辑漏洞整理
subtitle:   渗透测试
date:       2020-12-01
author:     matrix
header-img: img/websecurity.jpeg
catalog: true
tags:
    - 渗透测试
---
## 分类
逻辑漏洞主要产生的位置：登录处、业务办理处（群消息，）、验证码处、支付处、密码找回处。
### 任意密码重置
未对短信验证码进行校验，通过修改 url 直接绕过短信验证码的校验步骤，在重 置密码处可通过 userID 参数直接进行密码的重置操作，直接进入重置页面进行重置。
修复建议：重置密码时同时验证手机验证码 
### 弱口令
修复建议：
①强制用户首次登录时修改默认口令，或是使用用户自定义初始密码的策略。
②完善密码策略，信息安全最佳实践的密码策略为8位（包括）以上字符，包含数字、大小写字母、特殊字符中的至少3种。
③增加人机验证机制，限制ip访问次数。
### 登陆绕过
由于对登录的账号及口令校验存在逻辑缺陷，或再次使用服务器端返回的相关参 数作为最终登录凭证，导致可绕过登录限制，如服务器返回一个 flag 参数作为 登录是否成功的标准，但是由于代码最后登录是否成功是通过获取这个 flag 参 数来作为最终的验证，导致攻击者通过修改 flag 参数即可绕过登录的限制。
管理员登录页面，使用 burp 抓包，随意填写一个登录名和密码，发现在登录状态中服务器
会返回一个确认位，逻辑确认 1 为成功认证，0 为认证失败。此时抓服务器的返回包并将其确认位 0 修改为 1，然后将其发送给客户端，客户端便会认为认证成功，然后紧接着服务器会继续发送登 录名的确认，此时将 0 修改为 admin 便可直接以 admin 身份登录，而不需要密码。
修复建议：修改验证逻辑，如是否登录成功服务器端返回一个参数，但是到此就是最终验证，不需要再对返回的参数进行使用并作为登录是否成功的最终判断依据。
### 万能密码
该漏洞多与 SQL 语句相关，利用该漏洞可在不知用户名密码的情况下，构造真条件绕过登录限制，登录用户。
![-c385](/img/16068130720070.jpg)
### 弱token爆破
有些时候通过找回密码的时候填邮箱，邮箱此时会收到一个带有token的链接，点击链接就能跳转到重置密码的页面，如果token是base64，时间戳，位数较低的随机数则可以爆破
通常思路：
正常找回流程获取重置密码的url，了解token的规则后，爆破其他邮箱的重置密码url
修复建议：增加token复杂度
### session覆盖
已知A的手机号，不知B的手机号，找回A的密码，输入验证码后到了设置新密码设置界面。这时在同一浏览器下重开窗口找回B的密码，获取验证码，刷新A设置新密码的页面，如果此时修改的是B账号的密码，则存在漏洞
通常思路：
准备2个账号，测试步骤如上所述
在邮箱收到找回密码连接时，依然可以使用该思路
### 服务器端session未清空
登出后服务器端的session内容没有清除，因此客户端重新带回登出前的session，也能够达到重新登录
通常思路：
在登出后，拿登出前的session，重新访问需要登录的界面
修复建议：用户登出后清空session
### 邮件/短信轰炸
修改邮件或修改手机号处；获取验证码处；后台发送邀请邮件处；后台群发消息处
修复建议：在服务器限制发送邮件的频率，如同一账号1分钟只能发送1次邮件，一天只能发送3次。
### 账户名枚举
登陆或注册处，如果会对用户名、手机号、邮箱等进行验证是否存在，则可以通过枚举的方式判断存在的用户。
修复建议：采用模糊提示，防止用户名被枚举。建议统一错误回显，避免显示详细的错误信息。对存在和不存在的用户返回同样的数据。
### 暴力破解
登录处未设置验证码，导致可以进行暴力破解。
有时候会发现用户名或者密码是密文加密，这时可能是通过前端或者其他方式加密，对于简单的来说base64编码和md5的签名是很好识破的，在爆破的时候可以选择encode和hash
修复建议：对于网站的关键功能(例如登录，注册等)设置有效的验证码
### 批量用户注册
用户注册处未设置验证码，修改邮箱和手机号即可进行任意用户批量注册。
修复建议：结合身份认证机制进行有效的身份验证，主要是防止验证码被绕过，防止分步骤验证用户身份。
### 水平越权
通常说的越权一般是修改get或者post参数，导致的查看到他人的业务信息，一般看订单处，个人信息处等位置的参数，通常思路：拿2个账号，修改账号1的get或post参数，观察是否能获取账号2信息。
### 垂直越权
指修改参数获取更高权限用户的信息。
### 篡改手机号
在需要手机号的短信验证处，抓包修改手机号，可能做到非本账号手机号获取能够编辑本账号的验证码，通常思路：抓包，查看get或者post参数存在手机号的地方，进行修改
### 手机或邮箱验证码回显到客户端
在发送给手机或者邮箱验证码时，会在response包中有验证码，因此不需要手机和邮箱就可以获取验证码
通常思路：发送验证码时抓包，看返回包
### 修改response包绕过判定
在输入错误的验证码时会返回false之类的字段，如果修改response中的false为true，会识别为验证通过
通常思路：抓包，选择do intercept-> response to this request ,放包，抓到到下一个包就是response的包，可以修改，重放
### 修改商品编号
如果业务是通过商品编号来判断价格的话，可能存在只修改A商品编号为B商品编号，做到以A商品的价格购买B商品
通常思路：先准备2个商品的编号，将其中一个改为另一个
### 条件竞争
通过条件竞争使余额达到负数，从而买多个商品
通常思路：支付处，多线程请求付款确认，结果如果余额为负数，则存在该漏洞
### 金额修改
金额直接写在了post或者get请求中，对其进行修改达到修改了商品金额的效果
通常思路：抓包修改金额的字段
### 商品数量修改
在购买时，如果一个商品为负数，那么它的价格则会是负数，如果购买多种商品，将其中一个设为负数，降低整体的价格
通常思路：购物车里选取多个商品，修改其中一个商品的数量，在购买后查看最终的价格
### 通过前端限制限购商品
有些商品限购1个，但是判定是通过前端，因此可以抓包后修改数量
通常思路：抓取限购数量内的包，抓取后修改个数，重放
### 充值中放弃订单未失效
在充值中选取大额充值订单，放弃订单，获得订单号，之后充值小额订单，拿到充值成功的界面，将订单号修改为放弃的大额订单，观察是否成功
通常思路：看看充值的时候是否有订单号字段，如果有在成功界面修改为未支付的订单号，观察是否充值成功
